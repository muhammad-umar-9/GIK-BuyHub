<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login as Customer - Restaurant Project</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>Restaurant Project</header>

<div class="login-container">
    <h2>Customer Login</h2>
    <p class="subtitle">Sign in to continue your order.</p>

    <input type="email" id="customer-user-input" placeholder="Gmail address">
    <input type="password" id="customer-password-input" placeholder="Password">
    <div id="customer-error-message" class="error-message"></div>

    <!-- Location Input -->
    <input type="text" id="customer-location-input" placeholder="Enter your location (e.g., city or zip code)" required>

    <button class="main-btn" onclick="redirectToCustomerLanding()">Continue</button>

    <!-- New Button for Owner Access -->
    <button class="main-btn" onclick="requestOwnerPassword('customer')">Owner Access</button>

    <div class="footer-text">
        By proceeding, you accept our Terms & Privacy Policy.
    </div>

    <div class="account-switch">
        Don't have an account? <a href="customer_sign_up.html">Sign up</a>
    </div>
</div>

<!-- Modal for Owner Password Input -->
<div id="owner-password-modal" class="modal">
    <div class="modal-content">
        <h3>Enter Owner Password</h3>
        <input type="password" id="owner-password-input" placeholder="Owner Password">
        <button onclick="validateOwnerPassword('customer')">Submit</button>
        <button onclick="closeModal()">Cancel</button>
    </div>
</div>

<!-- Table to Display Registered Customers -->
<div id="customer-table-container" style="display: none;">
    <h3>Registered Customers</h3>
    <table id="customer-table" border="1">
        <tr>
            <th>Serial No.</th>
            <th>Name</th>
            <th>Email</th>
            <th>Type</th>
        </tr>
        <!-- Rows will be populated dynamically -->
    </table>
</div>

<script>
function redirectToCustomerLanding() {
    const email = document.getElementById('customer-user-input').value.trim();
    const password = document.getElementById('customer-password-input').value.trim();
    const location = document.getElementById('customer-location-input').value.trim(); // Get location
    const errorDiv = document.getElementById('customer-error-message');

    const storedUser = JSON.parse(localStorage.getItem(email));

    if (!email || !password || !location) {
        errorDiv.textContent = "Please enter both email, password, and location.";
    } else if (!email.includes("@gmail.com")) {
        errorDiv.textContent = "Only Gmail addresses are allowed.";
    } else if (!storedUser || storedUser.password !== password || storedUser.type !== 'customer') {
        errorDiv.textContent = "Account not found. Please sign up first.";
    } else {
        // Store the location to be used in the landing page (or elsewhere)
        localStorage.setItem('customerLocation', location);
        errorDiv.textContent = "";
        window.location.href = "customerLandingPage.html"; // Redirect to landing page
    }
}

function requestOwnerPassword(userType) {
    // Display the modal to ask for owner password
    document.getElementById('owner-password-modal').style.display = 'block';
    // Store the user type for use in password validation
    localStorage.setItem('requestedUserType', userType);
}

function validateOwnerPassword(userType) {
    const ownerPassword = document.getElementById('owner-password-input').value.trim();
    const correctOwnerPassword = 'owner123';  // Define this password globally or in a config
    
    if (ownerPassword === correctOwnerPassword) {
        displayUserData(userType);  // Show registered users if password is correct
        closeModal();
    } else {
        alert("Incorrect owner password.");
    }
}

function closeModal() {
    document.getElementById('owner-password-modal').style.display = 'none';
}

function displayUserData(userType) {
    const userTable = document.getElementById(`${userType}-table`);
    const userTableContainer = document.getElementById(`${userType}-table-container`);
    userTableContainer.style.display = 'block';
    
    // Clear previous rows (if any)
    userTable.innerHTML = `
        <tr>
            <th>Serial No.</th>
            <th>Name</th>
            <th>Email</th>
            <th>Type</th>
        </tr>
    `;
    
    let serialNo = 1;  // Initialize serial number
    for (let key in localStorage) {
        const userData = JSON.parse(localStorage.getItem(key));
        if (userData && userData.type === userType) {
            const row = userTable.insertRow();
            row.insertCell(0).innerText = serialNo++;  // Display serial number
            row.insertCell(1).innerText = userData.name;
            row.insertCell(2).innerText = key;
            row.insertCell(3).innerText = userData.type;
        }
    }
}
</script>

</body>
</html>
